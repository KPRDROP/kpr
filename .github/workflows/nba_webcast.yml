name: NBA Webcast Scraper

on:
  schedule:
    - cron: "*/30 * * * *"   # Every 30 minutes (adjust as needed)
  workflow_dispatch:        # Allow manual runs

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
    # --- Checkout repository ---
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        persist-credentials: false

    # --- Install Python 3.11 ---
    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    # --- Install Dependencies ---
    - name: Install requirements
      run: |
        pip install --upgrade pip
        pip install aiohttp beautifulsoup4 lxml

    # --- Run Script ---
    - name: Run NBA Webcast scraper
      run: |
        echo "ðŸš€ Starting NBA Webcast Scraper..."
        python nba_webcast.py

    # --- Upload Build Artifacts (optional) ---
    - name: Upload nba_webcast.m3u8 Artifact
      uses: actions/upload-artifact@v4
      with:
        name: nba_webcast
        path: NBAWebcast_VLC.m3u8

    - name: Upload nba_webcast_tivimate.m3u8 Artifact
      uses: actions/upload-artifact@v4
      with:
        name: nba_webcast_tivimate
        path: NBAWebcast_TiviMate.m3u8

    # --- Commit & Push to Repo ---
    - name: Configure git user
      run: |
        git config --global user.email "actions@github.com"
        git config --global user.name "GitHub Actions"

    - name: Commit updated playlists
      run: |
        git add nba_webcast.m3u8 nba_webcast_tivimate.m3u8
        if git commit -m "Auto-update NBA playlists $(date)" ; then
          echo "âœ” Commit created."
        else
          echo "âœ” No changes detected, skipping commit."
        fi

    - name: Push changes
      uses: ad-m/github-push-action@v0.8.0
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: main
